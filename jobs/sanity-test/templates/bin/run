#!/bin/bash

set -e # exit immediately if a simple command exits with a non-zero status
set -u # report the usage of uninitialized variables

# Setup env vars and folders for the webapp_ctl script
source /var/vcap/jobs/sanity-test/helpers/ctl_setup.sh 'sanity-test'

export BROKER_ADDRESS="<%= p('vault.broker.address') %>"
export BROKER_USERNAME="<%= p('vault.broker.username') %>"
export BROKER_PASSWORD="<%= p('vault.broker.password') %>"

curl -u ${BROKER_USERNAME}:${BROKER_PASSWORD} ${BROKER_ADDRESS}/v2/catalog | jq .

echo "Errand sanity-test is complete"
